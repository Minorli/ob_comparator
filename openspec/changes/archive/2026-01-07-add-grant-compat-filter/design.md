## Context
The fixup pipeline emits GRANT DDL derived from Oracle privileges. OceanBase (Oracle mode) does not implement all Oracle system privileges, so executing GRANT statements may fail. We also emit GRANTs to roles, but currently do not emit CREATE ROLE DDL for user-defined roles, causing role grants to fail.

## Goals / Non-Goals
- Goals:
  - Filter unsupported system/object privileges from generated GRANT statements.
  - Generate CREATE ROLE DDL for user-defined roles referenced by grants.
  - Document Oracle vs OB privilege differences discovered via live connections.
  - Split OMS-ready missing exports into per-schema TABLE and VIEW files.
- Non-Goals:
  - Rewrite application code or role passwords.
  - Grant/role synchronization beyond DDL generation.

## Decisions
- Use OB system privileges granted to SYS as the supported system-privilege catalog.
- Use Oracle SYSTEM_PRIVILEGE_MAP as the source system-privilege catalog.
- Filter system privileges in GRANT generation using the supported catalog.
- For object privileges, use a conservative allowlist (SELECT, INSERT, UPDATE, DELETE, REFERENCES, EXECUTE) with a config override if needed, because OB does not expose a table-privilege map.
- Generate CREATE ROLE statements for user-defined roles referenced by grants; skip Oracle-maintained roles when that metadata is available.

## Data Sources
Oracle (thin mode):
- System privileges: `SELECT NAME FROM SYSTEM_PRIVILEGE_MAP ORDER BY NAME`
- Table privileges: `SELECT NAME FROM TABLE_PRIVILEGE_MAP ORDER BY NAME`
- Roles: `SELECT ROLE, AUTHENTICATION_TYPE, PASSWORD_REQUIRED, ORACLE_MAINTAINED FROM DBA_ROLES`

OceanBase (obclient):
- System privileges (supported catalog): `SELECT PRIVILEGE FROM DBA_SYS_PRIVS WHERE GRANTEE='SYS'`
- Existing grants (for reference): `DBA_SYS_PRIVS`, `DBA_TAB_PRIVS`, `DBA_ROLE_PRIVS`

## Observed Oracle vs OB System Privileges
Source: Oracle SYSTEM_PRIVILEGE_MAP (257 total) vs OB DBA_SYS_PRIVS (SYS grantee, 80 total).
Unsupported system privileges detected (Oracle minus OB): 179

```
ADMINISTER ANY SQL TUNING SET
ADMINISTER DATABASE TRIGGER
ADMINISTER KEY MANAGEMENT
ADMINISTER RESOURCE MANAGER
ADMINISTER SQL MANAGEMENT OBJECT
ADMINISTER SQL TUNING SET
ADVISOR
ALTER ANY ANALYTIC VIEW
ALTER ANY ASSEMBLY
ALTER ANY ATTRIBUTE DIMENSION
ALTER ANY CLUSTER
ALTER ANY CUBE
ALTER ANY CUBE BUILD PROCESS
ALTER ANY CUBE DIMENSION
ALTER ANY DIMENSION
ALTER ANY EDITION
ALTER ANY EVALUATION CONTEXT
ALTER ANY HIERARCHY
ALTER ANY INDEXTYPE
ALTER ANY LIBRARY
ALTER ANY MATERIALIZED VIEW
ALTER ANY MEASURE FOLDER
ALTER ANY MINING MODEL
ALTER ANY OPERATOR
ALTER ANY RULE
ALTER ANY RULE SET
ALTER ANY SQL PROFILE
ALTER ANY SQL TRANSLATION PROFILE
ALTER DATABASE LINK
ALTER LOCKDOWN PROFILE
ALTER PUBLIC DATABASE LINK
ALTER RESOURCE COST
ALTER ROLLBACK SEGMENT
ANALYZE ANY
ANALYZE ANY DICTIONARY
AUDIT SYSTEM
CHANGE NOTIFICATION
COMMENT ANY MINING MODEL
CREATE ANALYTIC VIEW
CREATE ANY ANALYTIC VIEW
CREATE ANY ASSEMBLY
CREATE ANY ATTRIBUTE DIMENSION
CREATE ANY CLUSTER
CREATE ANY CREDENTIAL
CREATE ANY CUBE
CREATE ANY CUBE BUILD PROCESS
CREATE ANY CUBE DIMENSION
CREATE ANY DIMENSION
CREATE ANY EDITION
CREATE ANY EVALUATION CONTEXT
CREATE ANY HIERARCHY
CREATE ANY INDEXTYPE
CREATE ANY JOB
CREATE ANY LIBRARY
CREATE ANY MATERIALIZED VIEW
CREATE ANY MEASURE FOLDER
CREATE ANY MINING MODEL
CREATE ANY OPERATOR
CREATE ANY RULE
CREATE ANY RULE SET
CREATE ANY SQL PROFILE
CREATE ANY SQL TRANSLATION PROFILE
CREATE ASSEMBLY
CREATE ATTRIBUTE DIMENSION
CREATE CLUSTER
CREATE CREDENTIAL
CREATE CUBE
CREATE CUBE BUILD PROCESS
CREATE CUBE DIMENSION
CREATE DIMENSION
CREATE EVALUATION CONTEXT
CREATE EXTERNAL JOB
CREATE HIERARCHY
CREATE INDEXTYPE
CREATE JOB
CREATE LIBRARY
CREATE LOCKDOWN PROFILE
CREATE MATERIALIZED VIEW
CREATE MEASURE FOLDER
CREATE MINING MODEL
CREATE OPERATOR
CREATE PLUGGABLE DATABASE
CREATE ROLLBACK SEGMENT
CREATE RULE
CREATE RULE SET
CREATE SQL TRANSLATION PROFILE
DEBUG CONNECT ANY
DELETE ANY CUBE DIMENSION
DELETE ANY MEASURE FOLDER
DEQUEUE ANY QUEUE
DROP ANY ANALYTIC VIEW
DROP ANY ASSEMBLY
DROP ANY ATTRIBUTE DIMENSION
DROP ANY CLUSTER
DROP ANY CUBE
DROP ANY CUBE BUILD PROCESS
DROP ANY CUBE DIMENSION
DROP ANY DIMENSION
DROP ANY EDITION
DROP ANY EVALUATION CONTEXT
DROP ANY HIERARCHY
DROP ANY INDEXTYPE
DROP ANY LIBRARY
DROP ANY MATERIALIZED VIEW
DROP ANY MEASURE FOLDER
DROP ANY MINING MODEL
DROP ANY OPERATOR
DROP ANY RULE
DROP ANY RULE SET
DROP ANY SQL PROFILE
DROP ANY SQL TRANSLATION PROFILE
DROP LOCKDOWN PROFILE
DROP PUBLIC DATABASE LINK
DROP ROLLBACK SEGMENT
EM EXPRESS CONNECT
ENQUEUE ANY QUEUE
EXECUTE ANY ASSEMBLY
EXECUTE ANY CLASS
EXECUTE ANY EVALUATION CONTEXT
EXECUTE ANY INDEXTYPE
EXECUTE ANY LIBRARY
EXECUTE ANY OPERATOR
EXECUTE ANY PROGRAM
EXECUTE ANY RULE
EXECUTE ANY RULE SET
EXECUTE ASSEMBLY
EXEMPT ACCESS POLICY
EXEMPT IDENTITY POLICY
EXEMPT REDACTION POLICY
EXPORT FULL DATABASE
FLASHBACK ARCHIVE ADMINISTER
FORCE ANY TRANSACTION
FORCE TRANSACTION
GLOBAL QUERY REWRITE
IMPORT FULL DATABASE
INHERIT ANY PRIVILEGES
INHERIT ANY REMOTE PRIVILEGES
INSERT ANY CUBE DIMENSION
INSERT ANY MEASURE FOLDER
KEEP DATE TIME
KEEP SYSGUID
LOGMINING
MANAGE ANY FILE GROUP
MANAGE ANY QUEUE
MANAGE FILE GROUP
MANAGE SCHEDULER
MANAGE TABLESPACE
MERGE ANY VIEW
ON COMMIT REFRESH
QUERY REWRITE
READ ANY ANALYTIC VIEW CACHE
READ ANY FILE GROUP
READ ANY TABLE
REDEFINE ANY TABLE
RESTRICTED SESSION
RESUMABLE
SELECT ANY CUBE
SELECT ANY CUBE BUILD PROCESS
SELECT ANY CUBE DIMENSION
SELECT ANY MEASURE FOLDER
SELECT ANY MINING MODEL
SELECT ANY TRANSACTION
SET CONTAINER
SYSBACKUP
SYSDBA
SYSDG
SYSOPER
SYSRAC
TEXT DATASTORE ACCESS
TRANSLATE ANY SQL
UNDER ANY TABLE
UNDER ANY VIEW
UNLIMITED TABLESPACE
UPDATE ANY CUBE
UPDATE ANY CUBE BUILD PROCESS
UPDATE ANY CUBE DIMENSION
USE ANY JOB RESOURCE
USE ANY SQL TRANSLATION PROFILE
WRITE ANY ANALYTIC VIEW CACHE
```

## Oracle Table Privileges
From Oracle TABLE_PRIVILEGE_MAP (26):
ALTER, AUDIT, COMMENT, CREATE, DEBUG, DELETE, DEQUEUE, ENQUEUE, EXECUTE, FLASHBACK, FLASHBACK ARCHIVE, GRANT, INDEX, INSERT, LOCK, MERGE VIEW, ON COMMIT REFRESH, QUERY REWRITE, READ, REFERENCES, RENAME, SELECT, UNDER, UPDATE, USE, WRITE.

OB does not expose a table-privilege map; default object-privilege allowlist will be used (SELECT, INSERT, UPDATE, DELETE, REFERENCES, EXECUTE) with a config override if required. MERGE VIEW (and similar unsupported object privileges) will be filtered from GRANT output.

## Role DDL Strategy
- Load roles from DBA_ROLES.
- Keep roles referenced as grantees or granted_role entries in DBA_ROLE_PRIVS or as grantees in DBA_SYS_PRIVS/DBA_TAB_PRIVS.
- Skip ORACLE_MAINTAINED='Y' when column is available.
- Emit CREATE ROLE statements before any GRANT that references those roles.
- If authentication type is PASSWORD or EXTERNAL, emit a warning comment and create role with NOT IDENTIFIED to avoid blocking grant application.

## Risks / Trade-offs
- Using SYS-granted privileges in OB may omit privileges that are supported but not granted. Mitigation: allow config overrides and log any filtered privilege names.
- Role authentication types cannot be fully replicated without passwords; create roles without password and log warnings.

## Migration Plan
- Implement privilege catalog load (OB) and Oracle privilege list (Oracle).
- Apply filters to GRANT statements, record skipped privileges in logs and summary.
- Add CREATE ROLE DDL generation in fixup_scripts/grants.
- Split OMS-ready missing exports into per-schema TABLE and VIEW files under main_reports/tables_views_miss.
- Export filtered/unsupported GRANT privileges to main_reports/filtered_grants.txt.

## Open Questions
- Should object privilege allowlist be exposed in config (recommended) or stay internal?
- Should we output a separate report file listing filtered privileges?
